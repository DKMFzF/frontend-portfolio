"use strict";(globalThis.webpackChunkdkmfzf_frontend_portfolio=globalThis.webpackChunkdkmfzf_frontend_portfolio||[]).push([[869],{87869:(e,a,t)=>{t.r(a),t.d(a,{default:()=>I});var o=t(74848);const n="ControlManual-module__control-manual__char__hBPhP",r=()=>(0,o.jsx)(o.Fragment,{children:(0,o.jsx)("div",{className:"ControlManual-module__control-manual__QNcJ3",children:(0,o.jsxs)("div",{className:"ControlManual-module__control-manual__description__pwbnu",children:[(0,o.jsx)("p",{children:"Use the WASD keys to move"}),(0,o.jsxs)("div",{className:"ControlManual-module__control-manual__controls-keys__M43Tj",children:[(0,o.jsx)("span",{className:n,children:"W"}),(0,o.jsx)("span",{className:n,children:"A"}),(0,o.jsx)("span",{className:n,children:"S"}),(0,o.jsx)("span",{className:n,children:"D"})]})]})})});var i=t(96540),s=t(73560),l=t(47642),c=t(28027);const u=({position:e,intensity:a,shadowMapsSize:t})=>(0,o.jsx)("pointLight",{position:e,intensity:a,"shadow-mapSize-width":t,"shadow-mapSize-height":t,"shadow-camera-near":.5,"shadow-camera-far":50,"shadow-camera-left":-10,"shadow-camera-right":10,"shadow-camera-top":10,"shadow-camera-bottom":-10,"shadow-bias":-.001,"shadow-normalBias":.05});var m=t(24922);const d=(e,a)=>{let t=!1;for(const o of e)if((new m.NRn).setFromObject(o).containsPoint(a)){t=!0;break}return t},h=128,w=2.3,p=[{position:[-4.31,2,.3],intensity:1,shadowMapsSize:h},{position:[-4.31,2,1.8],intensity:1,shadowMapsSize:h},{position:[-2.15,w,-1.6],intensity:3,shadowMapsSize:h},{position:[.4,w,-.8],intensity:2,shadowMapsSize:h},{position:[.4,w,-2.5],intensity:2,shadowMapsSize:h},{position:[-.1,w,.7],intensity:2,shadowMapsSize:h},{position:[2.2,w,2],intensity:3,shadowMapsSize:h},{position:[2.8,w,-2.2],intensity:3,shadowMapsSize:h}],f=[0,0,0],g={Screen:{startsWith:"screen"},screen:{exact:"screen"},WrapperWalka:{startsWith:"wrapperwalka"},wrapperwalka:{exact:"wrapperwalka"},Light:{startsWith:"light"},light:{exact:"light"},Luminaire:{startsWith:"luminaire"},luminaire:{exact:"luminaire"},Window:{startsWith:"window"},window:{exact:"window"},Roof:{startsWith:"roof"},roof:{exact:"roof"},Wall:{startsWith:"wall"},wall:{exact:"wall"},Floor:{startsWith:"floor"},floor:{exact:"floor"}},y={camera:{position:[-5,5,0],fov:75,near:.1,far:1e3},shadows:{type:m.Wk7}},v={shiftHoverActive:.01,rotationShape:[-Math.PI/2,0,0]},x=150,C=60,M=100,S={position:[10,20,10],intensity:1,shadowMapSizeWidth:1024,shadowCameraNear:.5,shadowCameraFar:50,shadowCameraLeft:-10,shadowCameraRight:10,shadowCameraTop:10,shadowCameraBottom:-10},k=(e,a)=>{const{exact:t,startsWith:o}=g[a];return t?e===t:e.toLowerCase().startsWith(o)},P="#define GLSLIFY 1\nvoid main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n",_="/*\n  shader for the background\n*/\n\n// calculation accuracy for WebGL render\n#ifdef GL_ES\n  precision mediump float;\n#define GLSLIFY 1\n#endif\n\nuniform vec2 u_resolution;\nuniform float u_time;\nuniform vec3 u_baseColor;\n\n/*\n  gradient for the background\n  works by shifting vectors multiplied by cos\n*/\nvoid colorVector3ShiftGradient(\n  inout vec3 trip,\n  float warpsScale,\n  float waveMultiplicator,\n  float waveSize,\n  float time\n) {\n  vec3 permutationVectorCos = trip.yzx + (time * .25);\n\n  // wave first\n  trip.xyz += warpsScale \n    * ((waveSize * waveMultiplicator) + .1)\n    * cos(3. * permutationVectorCos);\n  \n  // wave second\n  trip.xyz += warpsScale \n    * ((waveSize * waveMultiplicator) + .05) \n    * cos(11. * permutationVectorCos);\n\n  // wave tertius\n  trip.xyz += warpsScale \n    * ((waveSize * waveMultiplicator) + .025)\n    * cos(17. * permutationVectorCos);\n}\n\nvoid main()\n{\n  const float speedAnimation = .1;\n  const float ratioVatiation = 0.05;\n  const float waveStartGradient = .01;\n  const float waveMultiplicatorGradient = 2.;\n  const float warpsScaleGradient = 1.5;\n  const float mixRatioFilter = 0.3;\n  const float mixBrightnessFolter = 1.;\n  const float alphaFragColor = 1.;\n\n  float t = u_time * speedAnimation;\n  vec3 baseColor = u_baseColor;\n  vec3 variationColors = vec3(\n    ratioVatiation * cos(t),\n    ratioVatiation * cos(t + 2.0),\n    ratioVatiation * cos(t + 3.0)\n  );\n\n  vec3 color = baseColor + variationColors;\n\n  colorVector3ShiftGradient(\n    color,\n    warpsScaleGradient,\n    waveStartGradient,\n    waveMultiplicatorGradient,\n    u_time\n  );\n\n  color = mix(color, vec3(mixBrightnessFolter), mixRatioFilter);\n\n  gl_FragColor = vec4(color, alphaFragColor);\n}\n",j=new m.BKk({vertexShader:P,fragmentShader:_,uniforms:{u_time:{value:0},u_resolution:{value:new m.I9Y(window.innerWidth,window.innerHeight)},u_baseColor:{value:new m.Pq0(.9,.8,.7)}}}),L=new m.BKk({vertexShader:P,fragmentShader:_,uniforms:{u_time:{value:0},u_resolution:{value:new m.I9Y(window.innerWidth,window.innerHeight)},u_baseColor:{value:new m.Pq0(.251,.878,.816)}}}),b=(new m._4j({color:4251856,emissive:4251856,emissiveIntensity:.5,metalness:.1,roughness:.5}),new m._4j({emissive:16777215,emissiveIntensity:.9})),D=new m._4j({color:"gray",transparent:!0,opacity:.1}),W=new m._4j({color:"gray",transparent:!0,opacity:.1,side:m.$EB}),F=new m.uSd({color:16777215,transparent:!0,opacity:.1,metalness:0,roughness:.05,side:m.$EB}),z=new m.tcD(.5,32),R=new m.V9B({color:"yellow",transparent:!0,opacity:.5});var E=t(2056),A=t(15225);const B=({modelPath:e,onFloorClick:a,firstPersonMode:t,hoverPointMouseData:n})=>{const{scene:r,lightRef:s,wallsRef:l,roofRef:c}=(e=>{const a=(0,A.p)(e).scene,t=(0,i.useRef)([]),o=(0,i.useRef)([]),n=(0,i.useRef)([]);return(0,i.useEffect)((()=>{const e=[],r=[],i=[],s=[];a.traverse((a=>{a instanceof m.eaF&&(a.castShadow=!0,a.receiveShadow=!0,a.material instanceof m._4j&&(a.material.shadowSide=m.hB5),k(a.name,"Floor")&&(a.userData.isFloor=!0),k(a.name,"Wall")&&(r.push(a),a.userData.originalMaterial=a.material),k(a.name,"Roof")&&(i.push(a),a.userData.originalMaterial=a.material,a.raycast=()=>{}),k(a.name,"Window")&&(a.userData.originalMaterial=a.material,a.material=F,a.castShadow=!1,a.raycast=()=>{}),k(a.name,"WrapperWalka")&&(a.userData.originalMaterial=a.material,a.material=L),k(a.name,"Luminaire")&&(a.userData.originalMaterial=a.material,a.material=b,a.castShadow=!1,a.raycast=()=>{}),k(a.name,"Light")&&(e.push(a),a.userData.originalMaterial=a.material,a.castShadow=!1,a.raycast=()=>{}),k(a.name,"Screen")&&(s.push(a),a.userData.originalMaterial=a.material,a.material=j))})),t.current=e,o.current=r,n.current=i}),[a]),{scene:a,lightRef:t,wallsRef:o,roofRef:n}})(e),{hoverPoint:h,handlePointerDown:w,handlePointerMove:g,handleClick:y}=(e=>{const a=(0,i.useRef)(!1),[t,o]=(0,i.useState)(null);return{isDragging:a,hoverPoint:t,setHoverPoint:o,handlePointerDown:()=>{a.current=!1},handlePointerMove:e=>{a.current=!0,e.object.userData.isFloor?o(e.point):o(null)},handleClick:t=>{if(t.stopPropagation(),!a.current&&t.object.userData.isFloor){const a=t.point;e(a)}}}})(a),{hoverMeshRef:v}=(e=>{const a=(0,i.useRef)(null);return(0,E.F)((()=>{a.current&&e&&a.current.position.lerp(new m.Pq0(e.x,e.y+.01,e.z),.2)})),{hoverMeshRef:a}})(h);var x;return((e,a,t,o)=>{const{camera:n}=(0,E.D)(),[r,s]=(0,i.useState)(!o);(0,i.useEffect)((()=>{s(!o)}),[o]),(0,E.F)((()=>{const o=e.current,i=a.current,s=t.current;if(o.length>0&&r){const e=d(o,n.position);o.forEach((a=>{a.material=e?a.userData.originalMaterial:D}))}if(i.length>0&&r){const e=d(i,n.position);i.forEach((a=>{a.material=e?a.userData.originalMaterial:D}))}if(s.length>0&&r){const e=d(s,n.position);s.forEach((a=>{a.material=e?a.userData.originalMaterial:W}))}}))})(l,s,c,t),x=r,(0,E.F)((e=>{x.traverse((a=>{(a.name.includes("Screen")||a.name.includes("WrapperWalka"))&&"material"in a&&a.material instanceof m.BKk&&(a.material.uniforms.u_time.value=e.clock.getElapsedTime())}))})),(0,o.jsxs)(o.Fragment,{children:[p.map(((e,a)=>(0,o.jsx)(u,{position:e.position,intensity:e.intensity,shadowMapsSize:e.intensity},a))),(0,o.jsx)("primitive",{scale:2,object:r,position:f,onPointerDown:w,onPointerMove:g,onClick:y}),h&&(0,o.jsx)("mesh",{ref:v,geometry:z,material:R,position:[h.x,h.y+n.shiftHoverActive,h.z],rotation:n.rotationShape})]})};var T=t(26879);const G=({targetPosition:e,onExit:a})=>{const{camera:t}=(0,E.D)(),n=(0,i.useRef)(null),r=(0,i.useRef)(null),s=(e=>{const a=(0,i.useRef)({w:!1,a:!1,s:!1,d:!1});return(0,i.useEffect)((()=>{const t=t=>{"Escape"===t.key&&e(),"w"===t.key.toLowerCase()&&(a.current.w=!0),"a"===t.key.toLowerCase()&&(a.current.a=!0),"s"===t.key.toLowerCase()&&(a.current.s=!0),"d"===t.key.toLowerCase()&&(a.current.d=!0),"ц"===t.key.toLowerCase()&&(a.current.w=!0),"ф"===t.key.toLowerCase()&&(a.current.a=!0),"ы"===t.key.toLowerCase()&&(a.current.s=!0),"в"===t.key.toLowerCase()&&(a.current.d=!0)},o=e=>{"w"===e.key.toLowerCase()&&(a.current.w=!1),"a"===e.key.toLowerCase()&&(a.current.a=!1),"s"===e.key.toLowerCase()&&(a.current.s=!1),"d"===e.key.toLowerCase()&&(a.current.d=!1),"ц"===e.key.toLowerCase()&&(a.current.w=!1),"ф"===e.key.toLowerCase()&&(a.current.a=!1),"ы"===e.key.toLowerCase()&&(a.current.s=!1),"в"===e.key.toLowerCase()&&(a.current.d=!1)};return window.addEventListener("keydown",t),window.addEventListener("keyup",o),()=>{window.removeEventListener("keydown",t),window.removeEventListener("keyup",o)}}),[e]),a})(a),{wallsRef:l}=(()=>{const{scene:e}=(0,E.D)(),a=(0,i.useRef)([]),t=(0,i.useRef)([]),o=(0,i.useRef)([]);return(0,i.useEffect)((()=>{const n=[],r=[],i=[];e.traverse((e=>{("Wall"===e.name||e.name.toLowerCase().startsWith("wall")||"DoorMay228"===e.name||e.name.toLowerCase().startsWith("doormay228"))&&e instanceof m.eaF&&(n.push(e),e.userData.originalMaterial||(e.userData.originalMaterial=e.material)),("Roof"===e.name||e.name.toLowerCase().startsWith("roof"))&&e instanceof m.eaF&&(r.push(e),e.userData.originalMaterial||(e.userData.originalMaterial=e.material)),("Light"===e.name||e.name.toLowerCase().startsWith("light"))&&e instanceof m.eaF&&(i.push(e),e.userData.originalMaterial||(e.userData.originalMaterial=e.material))})),a.current=i,t.current=n,o.current=r,[i,n,r].forEach((e=>{e.forEach((e=>{e.userData.originalMaterial&&(e.material=e.userData.originalMaterial)}))}))}),[e]),{lightsRef:a,wallsRef:t,roofRef:o}})(),{playerCollider:c,checkWallCollisions:u}=(e=>{const a=(0,i.useRef)({radius:.1,height:.5,position:new m.Pq0});return{playerCollider:a,checkWallCollisions:t=>{const o=e.current;if(!o||!o.length)return!1;a.current.position.copy(t);for(const e of o)if(e instanceof m.eaF){const t=new m.iyt(a.current.position,a.current.radius);e.geometry.computeBoundingBox();const o=e.geometry.boundingBox?.clone();if(o&&(o.applyMatrix4(e.matrixWorld),t.intersectsBox(o)))return!0}return!1}}})(l);return((e,a,t,o)=>{const{camera:n}=(0,E.D)();(0,E.F)((()=>{if(null===o.current)return;const r=new m.Pq0;e.current.w&&(r.z-=.2),e.current.s&&(r.z+=.2),e.current.a&&(r.x-=.2),e.current.d&&(r.x+=.2),r.normalize(),r.multiplyScalar(.034),n.getWorldDirection(new m.Pq0),r.applyEuler(n.rotation);const i=n.position.clone().add(r);i.y=o.current,a(i)||(n.position.copy(i),t.current.position.copy(i))}))})(s,u,c,n),(e=>{(0,i.useEffect)((()=>{const a=()=>{!document.pointerLockElement&&e&&e()};return document.addEventListener("pointerlockchange",a),()=>{document.removeEventListener("pointerlockchange",a)}}),[e])})(a),(0,i.useEffect)((()=>{if(e){const a=e.clone().add(new m.Pq0(0,1.7,0));n.current=a.y,t.position.copy(a),t.rotation.set(0,0,0),c.current.position.copy(a),r.current&&r.current.lock()}}),[e,t,c]),(0,o.jsx)(T.Z,{ref:r})},N=({cameraAnimation:e,onAnimationComplete:a})=>((0,E.F)((({camera:t})=>{if(!e?.isAnimating)return;const o=Date.now()-e.startTime,n=Math.min(o/1e3,1),r=(i=n)<.5?4*Math.pow(i,3):1-4*Math.pow(1-i,3);var i;t.position.lerpVectors(e.startPosition,e.targetPosition,r),t.quaternion.slerpQuaternions(e.startQuaternion,e.targetQuaternion,r),n>=1&&a()})),null);var V=t(3407);const q=()=>{const e=(0,i.useRef)(null),{cameraAnimation:a,setCameraAnimation:t,startCameraAnimation:n}=(e=>{const[a,t]=(0,i.useState)(null);return{cameraAnimation:a,setCameraAnimation:t,startCameraAnimation:o=>{if(a?.isAnimating)return;const n=e.current?.object.position.clone()??new m.Pq0(-5,5,0),r=o.clone().add(new m.Pq0(0,1.7,0)),i=e.current?.object.quaternion.clone()??new m.PTz,s=(new m.PTz).setFromEuler(new m.O9p(0,0,0));t({isAnimating:!0,startTime:Date.now(),startPosition:n,targetPosition:r,startQuaternion:i,targetQuaternion:s})}}})(e),{firstPersonMode:r,setFirstPersonMode:u,targetPosition:d,setTargetPosition:h,exitFirstPersonMode:w}=(()=>{const[e,a]=(0,i.useState)(!1),[t,o]=(0,i.useState)(null);return{firstPersonMode:e,setFirstPersonMode:a,targetPosition:t,setTargetPosition:o,exitFirstPersonMode:()=>{a(!1)}}})();return(0,o.jsx)("div",{className:"WrapperModelScale-module__wrapper-model-scale__Teb8T",children:(0,o.jsx)(i.Suspense,{fallback:(0,o.jsx)(V.Z,{}),children:(0,o.jsxs)(s.Hl,{camera:{position:y.camera.position,fov:y.camera.fov,near:y.camera.near,far:y.camera.far},shadows:{type:y.shadows.type},children:[(0,o.jsx)(N,{cameraAnimation:a,onAnimationComplete:async()=>{t(null),u(!0);try{await document.body.requestPointerLock()}catch(e){console.error("Ошибка при запросе блокировки указателя:",e)}}}),(0,o.jsx)("hemisphereLight",{groundColor:"#b97a20",intensity:.2}),(0,o.jsx)("ambientLight",{intensity:0}),(0,o.jsx)("directionalLight",{castShadow:!0,position:S.position,intensity:S.intensity,"shadow-mapSize-width":S.shadowMapSizeWidth,"shadow-mapSize-height":S.shadowMapSizeWidth,"shadow-camera-near":S.shadowCameraNear,"shadow-camera-far":S.shadowCameraFar,"shadow-camera-left":S.shadowCameraLeft,"shadow-camera-right":S.shadowCameraRight,"shadow-camera-top":S.shadowCameraTop,"shadow-camera-bottom":S.shadowCameraBottom}),(0,o.jsx)(l.OH,{files:"../../cyclorama_hard_light_1k.exr",background:!0,backgroundIntensity:0,environmentIntensity:0,ground:{radius:x,height:C,scale:M}}),(0,o.jsx)(B,{modelPath:"../../apartments-model.glb",onFloorClick:e=>{r||a?.isAnimating||(n(e),h(e))},firstPersonMode:r,hoverPointMouseData:v,objScale:2,objPosition:f}),(0,o.jsxs)("mesh",{rotation:[-Math.PI/2,0,0],position:[0,-.01,0],receiveShadow:!0,children:[(0,o.jsx)("planeGeometry",{args:[400,400]}),(0,o.jsx)("shadowMaterial",{opacity:.3})]}),r?(0,o.jsx)(G,{targetPosition:d,onExit:w}):(0,o.jsx)(c.N,{ref:e,enableZoom:!0,enablePan:!0,enableRotate:!0,maxPolarAngle:Math.PI/2,minDistance:10,maxDistance:30})]})})})};function I(){return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(q,{}),(0,o.jsx)(r,{})]})}}}]);