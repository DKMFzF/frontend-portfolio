"use strict";(globalThis.webpackChunkdkmfzf_frontend_portfolio=globalThis.webpackChunkdkmfzf_frontend_portfolio||[]).push([[722],{48722:(e,a,t)=>{t.r(a),t.d(a,{default:()=>G});var r=t(74848),o=t(96540),n=t(73560),i=t(47642),s=t(28027);const l=({position:e,intensity:a,shadowMapsSize:t})=>(0,r.jsx)("pointLight",{position:e,intensity:a,"shadow-mapSize-width":t,"shadow-mapSize-height":t,"shadow-camera-near":.5,"shadow-camera-far":50,"shadow-camera-left":-10,"shadow-camera-right":10,"shadow-camera-top":10,"shadow-camera-bottom":-10,"shadow-bias":-.001,"shadow-normalBias":.05});var c=t(24922);const u=(e,a)=>{let t=!1;for(const r of e)if((new c.NRn).setFromObject(r).containsPoint(a)){t=!0;break}return t},m=128,w=2.3,h=[{position:[-4.31,2,.3],intensity:1,shadowMapsSize:m},{position:[-4.31,2,1.8],intensity:1,shadowMapsSize:m},{position:[-2.15,w,-1.6],intensity:3,shadowMapsSize:m},{position:[.4,w,-.8],intensity:2,shadowMapsSize:m},{position:[.4,w,-2.5],intensity:2,shadowMapsSize:m},{position:[-.1,w,.7],intensity:2,shadowMapsSize:m},{position:[2.2,w,2],intensity:3,shadowMapsSize:m},{position:[2.8,w,-2.2],intensity:3,shadowMapsSize:m}],d=[0,0,0],p={Screen:{startsWith:"screen"},screen:{exact:"screen"},WrapperWalka:{startsWith:"wrapperwalka"},wrapperwalka:{exact:"wrapperwalka"},Light:{startsWith:"light"},light:{exact:"light"},Luminaire:{startsWith:"luminaire"},luminaire:{exact:"luminaire"},Window:{startsWith:"window"},window:{exact:"window"},Roof:{startsWith:"roof"},roof:{exact:"roof"},Wall:{startsWith:"wall"},wall:{exact:"wall"},Floor:{startsWith:"floor"},floor:{exact:"floor"}},f={camera:{position:[-5,5,0],fov:75,near:.1,far:1e3},shadows:{type:c.Wk7}},g={shiftHoverActive:.01,rotationShape:[-Math.PI/2,0,0]},y=150,v=60,C=100,M={position:[10,20,10],intensity:1,shadowMapSizeWidth:1024,shadowCameraNear:.5,shadowCameraFar:50,shadowCameraLeft:-10,shadowCameraRight:10,shadowCameraTop:10,shadowCameraBottom:-10},x=(e,a)=>{const{exact:t,startsWith:r}=p[a];return t?e===t:e.toLowerCase().startsWith(r)},S="void main() {\r\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r\n}\r\n",k="/*\r\n  shader for the background\r\n*/\r\n\r\n// calculation accuracy for WebGL render\r\n#ifdef GL_ES\r\n  precision mediump float;\r\n#endif\r\n\r\nuniform vec2 u_resolution;\r\nuniform float u_time;\r\nuniform vec3 u_baseColor;\r\n\r\n/*\r\n  gradient for the background\r\n  works by shifting vectors multiplied by cos\r\n*/\r\nvoid colorVector3ShiftGradient(\r\n  inout vec3 trip,\r\n  float warpsScale,\r\n  float waveMultiplicator,\r\n  float waveSize,\r\n  float time\r\n) {\r\n  vec3 permutationVectorCos = trip.yzx + (time * .25);\r\n\r\n  // wave first\r\n  trip.xyz += warpsScale \r\n    * ((waveSize * waveMultiplicator) + .1)\r\n    * cos(3. * permutationVectorCos);\r\n  \r\n  // wave second\r\n  trip.xyz += warpsScale \r\n    * ((waveSize * waveMultiplicator) + .05) \r\n    * cos(11. * permutationVectorCos);\r\n\r\n  // wave tertius\r\n  trip.xyz += warpsScale \r\n    * ((waveSize * waveMultiplicator) + .025)\r\n    * cos(17. * permutationVectorCos);\r\n}\r\n\r\nvoid main()\r\n{\r\n  const float speedAnimation = .1;\r\n  const float ratioVatiation = 0.05;\r\n  const float waveStartGradient = .01;\r\n  const float waveMultiplicatorGradient = 2.;\r\n  const float warpsScaleGradient = 1.5;\r\n  const float mixRatioFilter = 0.3;\r\n  const float mixBrightnessFolter = 1.;\r\n  const float alphaFragColor = 1.;\r\n\r\n  float t = u_time * speedAnimation;\r\n  vec3 baseColor = u_baseColor;\r\n  vec3 variationColors = vec3(\r\n    ratioVatiation * cos(t),\r\n    ratioVatiation * cos(t + 2.0),\r\n    ratioVatiation * cos(t + 3.0)\r\n  );\r\n\r\n  vec3 color = baseColor + variationColors;\r\n\r\n  colorVector3ShiftGradient(\r\n    color,\r\n    warpsScaleGradient,\r\n    waveStartGradient,\r\n    waveMultiplicatorGradient,\r\n    u_time\r\n  );\r\n\r\n  color = mix(color, vec3(mixBrightnessFolter), mixRatioFilter);\r\n\r\n  gl_FragColor = vec4(color, alphaFragColor);\r\n}\r\n",P=new c.BKk({vertexShader:S,fragmentShader:k,uniforms:{u_time:{value:0},u_resolution:{value:new c.I9Y(window.innerWidth,window.innerHeight)},u_baseColor:{value:new c.Pq0(.9,.8,.7)}}}),b=new c.BKk({vertexShader:S,fragmentShader:k,uniforms:{u_time:{value:0},u_resolution:{value:new c.I9Y(window.innerWidth,window.innerHeight)},u_baseColor:{value:new c.Pq0(.251,.878,.816)}}}),D=(new c._4j({color:4251856,emissive:4251856,emissiveIntensity:.5,metalness:.1,roughness:.5}),new c._4j({emissive:16777215,emissiveIntensity:.9})),L=new c._4j({color:"gray",transparent:!0,opacity:.1}),j=new c._4j({color:"gray",transparent:!0,opacity:.1,side:c.$EB}),W=new c.uSd({color:16777215,transparent:!0,opacity:.1,metalness:0,roughness:.05,side:c.$EB}),z=new c.tcD(.5,32),F=new c.V9B({color:"yellow",transparent:!0,opacity:.5});var R=t(2056),_=t(15225);const E=({modelPath:e,onFloorClick:a,firstPersonMode:t,hoverPointMouseData:n})=>{const{scene:i,lightRef:s,wallsRef:m,roofRef:w}=(e=>{const a=(0,_.p)(e).scene,t=(0,o.useRef)([]),r=(0,o.useRef)([]),n=(0,o.useRef)([]);return(0,o.useEffect)((()=>{const e=[],o=[],i=[],s=[];a.traverse((a=>{a instanceof c.eaF&&(a.castShadow=!0,a.receiveShadow=!0,a.material instanceof c._4j&&(a.material.shadowSide=c.hB5),x(a.name,"Floor")&&(a.userData.isFloor=!0),x(a.name,"Wall")&&(o.push(a),a.userData.originalMaterial=a.material),x(a.name,"Roof")&&(i.push(a),a.userData.originalMaterial=a.material,a.raycast=()=>{}),x(a.name,"Window")&&(a.userData.originalMaterial=a.material,a.material=W,a.castShadow=!1,a.raycast=()=>{}),x(a.name,"WrapperWalka")&&(a.userData.originalMaterial=a.material,a.material=b),x(a.name,"Luminaire")&&(a.userData.originalMaterial=a.material,a.material=D,a.castShadow=!1,a.raycast=()=>{}),x(a.name,"Light")&&(e.push(a),a.userData.originalMaterial=a.material,a.castShadow=!1,a.raycast=()=>{}),x(a.name,"Screen")&&(s.push(a),a.userData.originalMaterial=a.material,a.material=P))})),t.current=e,r.current=o,n.current=i}),[a]),{scene:a,lightRef:t,wallsRef:r,roofRef:n}})(e),{hoverPoint:p,handlePointerDown:f,handlePointerMove:g,handleClick:y}=(e=>{const a=(0,o.useRef)(!1),[t,r]=(0,o.useState)(null);return{isDragging:a,hoverPoint:t,setHoverPoint:r,handlePointerDown:()=>{a.current=!1},handlePointerMove:e=>{a.current=!0,e.object.userData.isFloor?r(e.point):r(null)},handleClick:t=>{if(t.stopPropagation(),!a.current&&t.object.userData.isFloor){const a=t.point;e(a)}}}})(a),{hoverMeshRef:v}=(e=>{const a=(0,o.useRef)(null);return(0,R.F)((()=>{a.current&&e&&a.current.position.lerp(new c.Pq0(e.x,e.y+.01,e.z),.2)})),{hoverMeshRef:a}})(p);var C;return((e,a,t,r)=>{const{camera:n}=(0,R.D)(),[i,s]=(0,o.useState)(!r);(0,o.useEffect)((()=>{s(!r)}),[r]),(0,R.F)((()=>{const r=e.current,o=a.current,s=t.current;if(r.length>0&&i){const e=u(r,n.position);r.forEach((a=>{a.material=e?a.userData.originalMaterial:L}))}if(o.length>0&&i){const e=u(o,n.position);o.forEach((a=>{a.material=e?a.userData.originalMaterial:L}))}if(s.length>0&&i){const e=u(s,n.position);s.forEach((a=>{a.material=e?a.userData.originalMaterial:j}))}}))})(m,s,w,t),C=i,(0,R.F)((e=>{C.traverse((a=>{(a.name.includes("Screen")||a.name.includes("WrapperWalka"))&&"material"in a&&a.material instanceof c.BKk&&(a.material.uniforms.u_time.value=e.clock.getElapsedTime())}))})),(0,r.jsxs)(r.Fragment,{children:[h.map(((e,a)=>(0,r.jsx)(l,{position:e.position,intensity:e.intensity,shadowMapsSize:e.intensity},a))),(0,r.jsx)("primitive",{scale:2,object:i,position:d,onPointerDown:f,onPointerMove:g,onClick:y}),p&&(0,r.jsx)("mesh",{ref:v,geometry:z,material:F,position:[p.x,p.y+n.shiftHoverActive,p.z],rotation:n.rotationShape})]})};var A=t(26879);const B=({targetPosition:e,onExit:a})=>{const{camera:t}=(0,R.D)(),n=(0,o.useRef)(null),i=(e=>{const a=(0,o.useRef)({w:!1,a:!1,s:!1,d:!1});return(0,o.useEffect)((()=>{const t=t=>{"Escape"===t.key&&e(),"w"===t.key.toLowerCase()&&(a.current.w=!0),"a"===t.key.toLowerCase()&&(a.current.a=!0),"s"===t.key.toLowerCase()&&(a.current.s=!0),"d"===t.key.toLowerCase()&&(a.current.d=!0),"ц"===t.key.toLowerCase()&&(a.current.w=!0),"ф"===t.key.toLowerCase()&&(a.current.a=!0),"ы"===t.key.toLowerCase()&&(a.current.s=!0),"в"===t.key.toLowerCase()&&(a.current.d=!0)},r=e=>{"w"===e.key.toLowerCase()&&(a.current.w=!1),"a"===e.key.toLowerCase()&&(a.current.a=!1),"s"===e.key.toLowerCase()&&(a.current.s=!1),"d"===e.key.toLowerCase()&&(a.current.d=!1),"ц"===e.key.toLowerCase()&&(a.current.w=!1),"ф"===e.key.toLowerCase()&&(a.current.a=!1),"ы"===e.key.toLowerCase()&&(a.current.s=!1),"в"===e.key.toLowerCase()&&(a.current.d=!1)};return window.addEventListener("keydown",t),window.addEventListener("keyup",r),()=>{window.removeEventListener("keydown",t),window.removeEventListener("keyup",r)}}),[e]),a})(a),{wallsRef:s}=(()=>{const{scene:e}=(0,R.D)(),a=(0,o.useRef)([]),t=(0,o.useRef)([]),r=(0,o.useRef)([]);return(0,o.useEffect)((()=>{const o=[],n=[],i=[];e.traverse((e=>{("Wall"===e.name||e.name.toLowerCase().startsWith("wall")||"DoorMay228"===e.name||e.name.toLowerCase().startsWith("doormay228"))&&e instanceof c.eaF&&(o.push(e),e.userData.originalMaterial||(e.userData.originalMaterial=e.material)),("Roof"===e.name||e.name.toLowerCase().startsWith("roof"))&&e instanceof c.eaF&&(n.push(e),e.userData.originalMaterial||(e.userData.originalMaterial=e.material)),("Light"===e.name||e.name.toLowerCase().startsWith("light"))&&e instanceof c.eaF&&(i.push(e),e.userData.originalMaterial||(e.userData.originalMaterial=e.material))})),a.current=i,t.current=o,r.current=n,[i,o,n].forEach((e=>{e.forEach((e=>{e.userData.originalMaterial&&(e.material=e.userData.originalMaterial)}))}))}),[e]),{lightsRef:a,wallsRef:t,roofRef:r}})(),{playerCollider:l,checkWallCollisions:u}=(e=>{const a=(0,o.useRef)({radius:.1,height:.5,position:new c.Pq0});return{playerCollider:a,checkWallCollisions:t=>{const r=e.current;if(!r||!r.length)return!1;a.current.position.copy(t);for(const e of r)if(e instanceof c.eaF){const t=new c.iyt(a.current.position,a.current.radius);e.geometry.computeBoundingBox();const r=e.geometry.boundingBox?.clone();if(r&&(r.applyMatrix4(e.matrixWorld),t.intersectsBox(r)))return!0}return!1}}})(s);return((e,a,t,r)=>{const{camera:o}=(0,R.D)();(0,R.F)((()=>{if(null===r.current)return;const n=new c.Pq0;e.current.w&&(n.z-=.2),e.current.s&&(n.z+=.2),e.current.a&&(n.x-=.2),e.current.d&&(n.x+=.2),n.normalize(),n.multiplyScalar(.034),o.getWorldDirection(new c.Pq0),n.applyEuler(o.rotation);const i=o.position.clone().add(n);i.y=r.current,a(i)||(o.position.copy(i),t.current.position.copy(i))}))})(i,u,l,n),(0,o.useEffect)((()=>{if(e){const a=e.clone().add(new c.Pq0(0,1.7,0));n.current=a.y,t.position.copy(a),t.rotation.set(0,0,0),l.current.position.copy(a)}}),[e,t,l]),(0,r.jsx)(A.Z,{})},T=({cameraAnimation:e,onAnimationComplete:a})=>((0,R.F)((({camera:t})=>{if(!e?.isAnimating)return;const r=Date.now()-e.startTime,o=Math.min(r/1e3,1),n=(i=o)<.5?4*Math.pow(i,3):1-4*Math.pow(1-i,3);var i;t.position.lerpVectors(e.startPosition,e.targetPosition,n),t.quaternion.slerpQuaternions(e.startQuaternion,e.targetQuaternion,n),o>=1&&a()})),null);var V=t(48672);const q=()=>{const e=(0,o.useRef)(null),{cameraAnimation:a,setCameraAnimation:t,startCameraAnimation:l}=(e=>{const[a,t]=(0,o.useState)(null);return{cameraAnimation:a,setCameraAnimation:t,startCameraAnimation:r=>{if(a?.isAnimating)return;const o=e.current?.object.position.clone()??new c.Pq0(-5,5,0),n=r.clone().add(new c.Pq0(0,1.7,0)),i=e.current?.object.quaternion.clone()??new c.PTz,s=(new c.PTz).setFromEuler(new c.O9p(0,0,0));t({isAnimating:!0,startTime:Date.now(),startPosition:o,targetPosition:n,startQuaternion:i,targetQuaternion:s})}}})(e),{firstPersonMode:u,setFirstPersonMode:m,targetPosition:w,setTargetPosition:h,exitFirstPersonMode:p}=(()=>{const[e,a]=(0,o.useState)(!1),[t,r]=(0,o.useState)(null);return{firstPersonMode:e,setFirstPersonMode:a,targetPosition:t,setTargetPosition:r,exitFirstPersonMode:()=>{a(!1)}}})();return(0,r.jsx)("div",{className:"WrapperModelScale-module__wrapper-model-scale__Teb8T",children:(0,r.jsx)(o.Suspense,{fallback:(0,r.jsx)(V.Z,{}),children:(0,r.jsxs)(n.Hl,{camera:{position:f.camera.position,fov:f.camera.fov,near:f.camera.near,far:f.camera.far},shadows:{type:f.shadows.type},children:[(0,r.jsx)(T,{cameraAnimation:a,onAnimationComplete:()=>{t(null),m(!0)}}),(0,r.jsx)("hemisphereLight",{groundColor:"#b97a20",intensity:.2}),(0,r.jsx)("ambientLight",{intensity:0}),(0,r.jsx)("directionalLight",{castShadow:!0,position:M.position,intensity:M.intensity,"shadow-mapSize-width":M.shadowMapSizeWidth,"shadow-mapSize-height":M.shadowMapSizeWidth,"shadow-camera-near":M.shadowCameraNear,"shadow-camera-far":M.shadowCameraFar,"shadow-camera-left":M.shadowCameraLeft,"shadow-camera-right":M.shadowCameraRight,"shadow-camera-top":M.shadowCameraTop,"shadow-camera-bottom":M.shadowCameraBottom}),(0,r.jsx)(i.OH,{files:"../../cyclorama_hard_light_1k.exr",background:!0,backgroundIntensity:0,environmentIntensity:0,ground:{radius:y,height:v,scale:C}}),(0,r.jsx)(E,{modelPath:"../../apartments-model.glb",onFloorClick:e=>{},firstPersonMode:u,hoverPointMouseData:g,objScale:2,objPosition:d}),(0,r.jsxs)("mesh",{rotation:[-Math.PI/2,0,0],position:[0,-.01,0],receiveShadow:!0,children:[(0,r.jsx)("planeGeometry",{args:[400,400]}),(0,r.jsx)("shadowMaterial",{opacity:.3})]}),u?(0,r.jsx)(B,{targetPosition:w,onExit:p}):(0,r.jsx)(s.N,{ref:e,enableZoom:!0,enablePan:!0,enableRotate:!0,maxPolarAngle:Math.PI/2,minDistance:7,maxDistance:30})]})})})};function G(){return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(q,{})})}}}]);