"use strict";(globalThis.webpackChunkdkmfzf_frontend_portfolio=globalThis.webpackChunkdkmfzf_frontend_portfolio||[]).push([[257],{24257:(e,a,t)=>{t.r(a),t.d(a,{default:()=>I});var r=t(74848);const o="ControlManual-module__control-manual__char__hBPhP",n=()=>(0,r.jsx)(r.Fragment,{children:(0,r.jsx)("div",{className:"ControlManual-module__control-manual__QNcJ3",children:(0,r.jsxs)("div",{className:"ControlManual-module__control-manual__description__pwbnu",children:[(0,r.jsx)("p",{children:"Use the WASD keys to move"}),(0,r.jsxs)("div",{className:"ControlManual-module__control-manual__controls-keys__M43Tj",children:[(0,r.jsx)("span",{className:o,children:"W"}),(0,r.jsx)("span",{className:o,children:"A"}),(0,r.jsx)("span",{className:o,children:"S"}),(0,r.jsx)("span",{className:o,children:"D"})]})]})})});var i=t(96540),s=t(73560),l=t(47642),c=t(28027);const u=({position:e,intensity:a,shadowMapsSize:t})=>(0,r.jsx)("pointLight",{position:e,intensity:a,"shadow-mapSize-width":t,"shadow-mapSize-height":t,"shadow-camera-near":.5,"shadow-camera-far":50,"shadow-camera-left":-10,"shadow-camera-right":10,"shadow-camera-top":10,"shadow-camera-bottom":-10,"shadow-bias":-.001,"shadow-normalBias":.05});var m=t(24922);const d=(e,a)=>{let t=!1;for(const r of e)if((new m.NRn).setFromObject(r).containsPoint(a)){t=!0;break}return t},h=128,w=2.3,p=[{position:[-4.31,2,.3],intensity:1,shadowMapsSize:h},{position:[-4.31,2,1.8],intensity:1,shadowMapsSize:h},{position:[-2.15,w,-1.6],intensity:3,shadowMapsSize:h},{position:[.4,w,-.8],intensity:2,shadowMapsSize:h},{position:[.4,w,-2.5],intensity:2,shadowMapsSize:h},{position:[-.1,w,.7],intensity:2,shadowMapsSize:h},{position:[2.2,w,2],intensity:3,shadowMapsSize:h},{position:[2.8,w,-2.2],intensity:3,shadowMapsSize:h}],f=[0,0,0],g={Screen:{startsWith:"screen"},screen:{exact:"screen"},WrapperWalka:{startsWith:"wrapperwalka"},wrapperwalka:{exact:"wrapperwalka"},Light:{startsWith:"light"},light:{exact:"light"},Luminaire:{startsWith:"luminaire"},luminaire:{exact:"luminaire"},Window:{startsWith:"window"},window:{exact:"window"},Roof:{startsWith:"roof"},roof:{exact:"roof"},Wall:{startsWith:"wall"},wall:{exact:"wall"},Floor:{startsWith:"floor"},floor:{exact:"floor"}},y={camera:{position:[-5,5,0],fov:75,near:.1,far:1e3},shadows:{type:m.Wk7}},v={shiftHoverActive:.01,rotationShape:[-Math.PI/2,0,0]},x=150,C=60,M=100,S={position:[10,20,10],intensity:1,shadowMapSizeWidth:1024,shadowCameraNear:.5,shadowCameraFar:50,shadowCameraLeft:-10,shadowCameraRight:10,shadowCameraTop:10,shadowCameraBottom:-10},k=(e,a)=>{const{exact:t,startsWith:r}=g[a];return t?e===t:e.toLowerCase().startsWith(r)},P="void main() {\r\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r\n}\r\n",_="/*\r\n  shader for the background\r\n*/\r\n\r\n// calculation accuracy for WebGL render\r\n#ifdef GL_ES\r\n  precision mediump float;\r\n#endif\r\n\r\nuniform vec2 u_resolution;\r\nuniform float u_time;\r\nuniform vec3 u_baseColor;\r\n\r\n/*\r\n  gradient for the background\r\n  works by shifting vectors multiplied by cos\r\n*/\r\nvoid colorVector3ShiftGradient(\r\n  inout vec3 trip,\r\n  float warpsScale,\r\n  float waveMultiplicator,\r\n  float waveSize,\r\n  float time\r\n) {\r\n  vec3 permutationVectorCos = trip.yzx + (time * .25);\r\n\r\n  // wave first\r\n  trip.xyz += warpsScale \r\n    * ((waveSize * waveMultiplicator) + .1)\r\n    * cos(3. * permutationVectorCos);\r\n  \r\n  // wave second\r\n  trip.xyz += warpsScale \r\n    * ((waveSize * waveMultiplicator) + .05) \r\n    * cos(11. * permutationVectorCos);\r\n\r\n  // wave tertius\r\n  trip.xyz += warpsScale \r\n    * ((waveSize * waveMultiplicator) + .025)\r\n    * cos(17. * permutationVectorCos);\r\n}\r\n\r\nvoid main()\r\n{\r\n  const float speedAnimation = .1;\r\n  const float ratioVatiation = 0.05;\r\n  const float waveStartGradient = .01;\r\n  const float waveMultiplicatorGradient = 2.;\r\n  const float warpsScaleGradient = 1.5;\r\n  const float mixRatioFilter = 0.3;\r\n  const float mixBrightnessFolter = 1.;\r\n  const float alphaFragColor = 1.;\r\n\r\n  float t = u_time * speedAnimation;\r\n  vec3 baseColor = u_baseColor;\r\n  vec3 variationColors = vec3(\r\n    ratioVatiation * cos(t),\r\n    ratioVatiation * cos(t + 2.0),\r\n    ratioVatiation * cos(t + 3.0)\r\n  );\r\n\r\n  vec3 color = baseColor + variationColors;\r\n\r\n  colorVector3ShiftGradient(\r\n    color,\r\n    warpsScaleGradient,\r\n    waveStartGradient,\r\n    waveMultiplicatorGradient,\r\n    u_time\r\n  );\r\n\r\n  color = mix(color, vec3(mixBrightnessFolter), mixRatioFilter);\r\n\r\n  gl_FragColor = vec4(color, alphaFragColor);\r\n}\r\n",j=new m.BKk({vertexShader:P,fragmentShader:_,uniforms:{u_time:{value:0},u_resolution:{value:new m.I9Y(window.innerWidth,window.innerHeight)},u_baseColor:{value:new m.Pq0(.9,.8,.7)}}}),L=new m.BKk({vertexShader:P,fragmentShader:_,uniforms:{u_time:{value:0},u_resolution:{value:new m.I9Y(window.innerWidth,window.innerHeight)},u_baseColor:{value:new m.Pq0(.251,.878,.816)}}}),b=(new m._4j({color:4251856,emissive:4251856,emissiveIntensity:.5,metalness:.1,roughness:.5}),new m._4j({emissive:16777215,emissiveIntensity:.9})),D=new m._4j({color:"gray",transparent:!0,opacity:.1}),W=new m._4j({color:"gray",transparent:!0,opacity:.1,side:m.$EB}),F=new m.uSd({color:16777215,transparent:!0,opacity:.1,metalness:0,roughness:.05,side:m.$EB}),z=new m.tcD(.5,32),R=new m.V9B({color:"yellow",transparent:!0,opacity:.5});var E=t(2056),A=t(15225);const B=({modelPath:e,onFloorClick:a,firstPersonMode:t,hoverPointMouseData:o})=>{const{scene:n,lightRef:s,wallsRef:l,roofRef:c}=(e=>{const a=(0,A.p)(e).scene,t=(0,i.useRef)([]),r=(0,i.useRef)([]),o=(0,i.useRef)([]);return(0,i.useEffect)((()=>{const e=[],n=[],i=[],s=[];a.traverse((a=>{a instanceof m.eaF&&(a.castShadow=!0,a.receiveShadow=!0,a.material instanceof m._4j&&(a.material.shadowSide=m.hB5),k(a.name,"Floor")&&(a.userData.isFloor=!0),k(a.name,"Wall")&&(n.push(a),a.userData.originalMaterial=a.material),k(a.name,"Roof")&&(i.push(a),a.userData.originalMaterial=a.material,a.raycast=()=>{}),k(a.name,"Window")&&(a.userData.originalMaterial=a.material,a.material=F,a.castShadow=!1,a.raycast=()=>{}),k(a.name,"WrapperWalka")&&(a.userData.originalMaterial=a.material,a.material=L),k(a.name,"Luminaire")&&(a.userData.originalMaterial=a.material,a.material=b,a.castShadow=!1,a.raycast=()=>{}),k(a.name,"Light")&&(e.push(a),a.userData.originalMaterial=a.material,a.castShadow=!1,a.raycast=()=>{}),k(a.name,"Screen")&&(s.push(a),a.userData.originalMaterial=a.material,a.material=j))})),t.current=e,r.current=n,o.current=i}),[a]),{scene:a,lightRef:t,wallsRef:r,roofRef:o}})(e),{hoverPoint:h,handlePointerDown:w,handlePointerMove:g,handleClick:y}=(e=>{const a=(0,i.useRef)(!1),[t,r]=(0,i.useState)(null);return{isDragging:a,hoverPoint:t,setHoverPoint:r,handlePointerDown:()=>{a.current=!1},handlePointerMove:e=>{a.current=!0,e.object.userData.isFloor?r(e.point):r(null)},handleClick:t=>{if(t.stopPropagation(),!a.current&&t.object.userData.isFloor){const a=t.point;e(a)}}}})(a),{hoverMeshRef:v}=(e=>{const a=(0,i.useRef)(null);return(0,E.F)((()=>{a.current&&e&&a.current.position.lerp(new m.Pq0(e.x,e.y+.01,e.z),.2)})),{hoverMeshRef:a}})(h);var x;return((e,a,t,r)=>{const{camera:o}=(0,E.D)(),[n,s]=(0,i.useState)(!r);(0,i.useEffect)((()=>{s(!r)}),[r]),(0,E.F)((()=>{const r=e.current,i=a.current,s=t.current;if(r.length>0&&n){const e=d(r,o.position);r.forEach((a=>{a.material=e?a.userData.originalMaterial:D}))}if(i.length>0&&n){const e=d(i,o.position);i.forEach((a=>{a.material=e?a.userData.originalMaterial:D}))}if(s.length>0&&n){const e=d(s,o.position);s.forEach((a=>{a.material=e?a.userData.originalMaterial:W}))}}))})(l,s,c,t),x=n,(0,E.F)((e=>{x.traverse((a=>{(a.name.includes("Screen")||a.name.includes("WrapperWalka"))&&"material"in a&&a.material instanceof m.BKk&&(a.material.uniforms.u_time.value=e.clock.getElapsedTime())}))})),(0,r.jsxs)(r.Fragment,{children:[p.map(((e,a)=>(0,r.jsx)(u,{position:e.position,intensity:e.intensity,shadowMapsSize:e.intensity},a))),(0,r.jsx)("primitive",{scale:2,object:n,position:f,onPointerDown:w,onPointerMove:g,onClick:y}),h&&(0,r.jsx)("mesh",{ref:v,geometry:z,material:R,position:[h.x,h.y+o.shiftHoverActive,h.z],rotation:o.rotationShape})]})};var T=t(26879);const N=({targetPosition:e,onExit:a})=>{const{camera:t}=(0,E.D)(),o=(0,i.useRef)(null),n=(0,i.useRef)(null),s=(e=>{const a=(0,i.useRef)({w:!1,a:!1,s:!1,d:!1});return(0,i.useEffect)((()=>{const t=t=>{"Escape"===t.key&&e(),"w"===t.key.toLowerCase()&&(a.current.w=!0),"a"===t.key.toLowerCase()&&(a.current.a=!0),"s"===t.key.toLowerCase()&&(a.current.s=!0),"d"===t.key.toLowerCase()&&(a.current.d=!0),"ц"===t.key.toLowerCase()&&(a.current.w=!0),"ф"===t.key.toLowerCase()&&(a.current.a=!0),"ы"===t.key.toLowerCase()&&(a.current.s=!0),"в"===t.key.toLowerCase()&&(a.current.d=!0)},r=e=>{"w"===e.key.toLowerCase()&&(a.current.w=!1),"a"===e.key.toLowerCase()&&(a.current.a=!1),"s"===e.key.toLowerCase()&&(a.current.s=!1),"d"===e.key.toLowerCase()&&(a.current.d=!1),"ц"===e.key.toLowerCase()&&(a.current.w=!1),"ф"===e.key.toLowerCase()&&(a.current.a=!1),"ы"===e.key.toLowerCase()&&(a.current.s=!1),"в"===e.key.toLowerCase()&&(a.current.d=!1)};return window.addEventListener("keydown",t),window.addEventListener("keyup",r),()=>{window.removeEventListener("keydown",t),window.removeEventListener("keyup",r)}}),[e]),a})(a),{wallsRef:l}=(()=>{const{scene:e}=(0,E.D)(),a=(0,i.useRef)([]),t=(0,i.useRef)([]),r=(0,i.useRef)([]);return(0,i.useEffect)((()=>{const o=[],n=[],i=[];e.traverse((e=>{("Wall"===e.name||e.name.toLowerCase().startsWith("wall")||"DoorMay228"===e.name||e.name.toLowerCase().startsWith("doormay228"))&&e instanceof m.eaF&&(o.push(e),e.userData.originalMaterial||(e.userData.originalMaterial=e.material)),("Roof"===e.name||e.name.toLowerCase().startsWith("roof"))&&e instanceof m.eaF&&(n.push(e),e.userData.originalMaterial||(e.userData.originalMaterial=e.material)),("Light"===e.name||e.name.toLowerCase().startsWith("light"))&&e instanceof m.eaF&&(i.push(e),e.userData.originalMaterial||(e.userData.originalMaterial=e.material))})),a.current=i,t.current=o,r.current=n,[i,o,n].forEach((e=>{e.forEach((e=>{e.userData.originalMaterial&&(e.material=e.userData.originalMaterial)}))}))}),[e]),{lightsRef:a,wallsRef:t,roofRef:r}})(),{playerCollider:c,checkWallCollisions:u}=(e=>{const a=(0,i.useRef)({radius:.1,height:.5,position:new m.Pq0});return{playerCollider:a,checkWallCollisions:t=>{const r=e.current;if(!r||!r.length)return!1;a.current.position.copy(t);for(const e of r)if(e instanceof m.eaF){const t=new m.iyt(a.current.position,a.current.radius);e.geometry.computeBoundingBox();const r=e.geometry.boundingBox?.clone();if(r&&(r.applyMatrix4(e.matrixWorld),t.intersectsBox(r)))return!0}return!1}}})(l);return((e,a,t,r)=>{const{camera:o}=(0,E.D)();(0,E.F)((()=>{if(null===r.current)return;const n=new m.Pq0;e.current.w&&(n.z-=.2),e.current.s&&(n.z+=.2),e.current.a&&(n.x-=.2),e.current.d&&(n.x+=.2),n.normalize(),n.multiplyScalar(.034),o.getWorldDirection(new m.Pq0),n.applyEuler(o.rotation);const i=o.position.clone().add(n);i.y=r.current,a(i)||(o.position.copy(i),t.current.position.copy(i))}))})(s,u,c,o),(e=>{(0,i.useEffect)((()=>{const a=()=>{!document.pointerLockElement&&e&&e()};return document.addEventListener("pointerlockchange",a),()=>{document.removeEventListener("pointerlockchange",a)}}),[e])})(a),(0,i.useEffect)((()=>{if(e){const a=e.clone().add(new m.Pq0(0,1.7,0));o.current=a.y,t.position.copy(a),t.rotation.set(0,0,0),c.current.position.copy(a),n.current&&n.current.lock()}}),[e,t,c]),(0,r.jsx)(T.Z,{ref:n})},V=({cameraAnimation:e,onAnimationComplete:a})=>((0,E.F)((({camera:t})=>{if(!e?.isAnimating)return;const r=Date.now()-e.startTime,o=Math.min(r/1e3,1),n=(i=o)<.5?4*Math.pow(i,3):1-4*Math.pow(1-i,3);var i;t.position.lerpVectors(e.startPosition,e.targetPosition,n),t.quaternion.slerpQuaternions(e.startQuaternion,e.targetQuaternion,n),o>=1&&a()})),null);var q=t(3407);const G=()=>{const e=(0,i.useRef)(null),{cameraAnimation:a,setCameraAnimation:t,startCameraAnimation:o}=(e=>{const[a,t]=(0,i.useState)(null);return{cameraAnimation:a,setCameraAnimation:t,startCameraAnimation:r=>{if(a?.isAnimating)return;const o=e.current?.object.position.clone()??new m.Pq0(-5,5,0),n=r.clone().add(new m.Pq0(0,1.7,0)),i=e.current?.object.quaternion.clone()??new m.PTz,s=(new m.PTz).setFromEuler(new m.O9p(0,0,0));t({isAnimating:!0,startTime:Date.now(),startPosition:o,targetPosition:n,startQuaternion:i,targetQuaternion:s})}}})(e),{firstPersonMode:n,setFirstPersonMode:u,targetPosition:d,setTargetPosition:h,exitFirstPersonMode:w}=(()=>{const[e,a]=(0,i.useState)(!1),[t,r]=(0,i.useState)(null);return{firstPersonMode:e,setFirstPersonMode:a,targetPosition:t,setTargetPosition:r,exitFirstPersonMode:()=>{a(!1)}}})();return(0,r.jsx)("div",{className:"WrapperModelScale-module__wrapper-model-scale__Teb8T",children:(0,r.jsx)(i.Suspense,{fallback:(0,r.jsx)(q.Z,{}),children:(0,r.jsxs)(s.Hl,{camera:{position:y.camera.position,fov:y.camera.fov,near:y.camera.near,far:y.camera.far},shadows:{type:y.shadows.type},children:[(0,r.jsx)(V,{cameraAnimation:a,onAnimationComplete:async()=>{t(null),u(!0);try{await document.body.requestPointerLock()}catch(e){console.error("Ошибка при запросе блокировки указателя:",e)}}}),(0,r.jsx)("hemisphereLight",{groundColor:"#b97a20",intensity:.2}),(0,r.jsx)("ambientLight",{intensity:0}),(0,r.jsx)("directionalLight",{castShadow:!0,position:S.position,intensity:S.intensity,"shadow-mapSize-width":S.shadowMapSizeWidth,"shadow-mapSize-height":S.shadowMapSizeWidth,"shadow-camera-near":S.shadowCameraNear,"shadow-camera-far":S.shadowCameraFar,"shadow-camera-left":S.shadowCameraLeft,"shadow-camera-right":S.shadowCameraRight,"shadow-camera-top":S.shadowCameraTop,"shadow-camera-bottom":S.shadowCameraBottom}),(0,r.jsx)(l.OH,{files:"../../cyclorama_hard_light_1k.exr",background:!0,backgroundIntensity:0,environmentIntensity:0,ground:{radius:x,height:C,scale:M}}),(0,r.jsx)(B,{modelPath:"../../apartments-model.glb",onFloorClick:e=>{n||a?.isAnimating||(o(e),h(e))},firstPersonMode:n,hoverPointMouseData:v,objScale:2,objPosition:f}),(0,r.jsxs)("mesh",{rotation:[-Math.PI/2,0,0],position:[0,-.01,0],receiveShadow:!0,children:[(0,r.jsx)("planeGeometry",{args:[400,400]}),(0,r.jsx)("shadowMaterial",{opacity:.3})]}),n?(0,r.jsx)(N,{targetPosition:d,onExit:w}):(0,r.jsx)(c.N,{ref:e,enableZoom:!0,enablePan:!0,enableRotate:!0,maxPolarAngle:Math.PI/2,minDistance:10,maxDistance:30})]})})})};function I(){return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(G,{}),(0,r.jsx)(n,{})]})}}}]);